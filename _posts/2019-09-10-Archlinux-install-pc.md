---
title: "Instalacion de Archlinux"
date: 2019-09-10
categories:
  - blog
tags:
  - i3wm
  - arch
  - sysadmin
---

# Quick Guide

## Configurar el sistema base
# Creando Hostname

El hostname o nombre de equipo es un nombre único para un equipo en una red. Estos nombres de host son cadenas de caracteres, en pocas palabras va a ser el nombre con el que nuestro equipo va a verse en la red. Para crearlo ejecutamos:
`$ echo nombredehost > /etc/hostname `

Tambien es importante establecer los DNS, últimamente pacman y yay para algunos paquetes exisgen que /etc/resolv.conf sea explicitamente creado:
```shell
~]$  cat << EOF | sudo tee /etc/resolv.conf  
# Generated by dhcpcd
# /etc/resolv.conf.head can replace this line
# /etc/resolv.conf.tail can replace this line

# Google DNS
nameserver 8.8.8.8 
nameserver 8.8.4.4
```

### Establecer la zona horaria

Es importante establecer la zona horaria. En la siguiente lista mostramos algunos países con la linea de comando que debemos ingresar según corresponda para establecer esta configuración.

`~]$ ls /usr/share/zoneinfo`

España

`~]$ ln -sf /usr/share/zoneinfo/Europe/Madrid /etc/localtime `

### Configurar idioma del sistema

Para configurar el idioma principal de nuestro sistema operativo vamos a editar el archivo locale.gen:

`~]# nano /etc/locale.gen`
Una vez dentro, buscamos nuestro país o región.
 > Descomentar es_ES.UTF-8 o en_US.UTF-8 ingles americano.
Establecemos nuestros preferencias de localización. 
`$ echo LANG=en_US.UTF-8 > /etc/locale.conf`

Generamos el archivo locale.gen con el siguiente comando:
`$ locale-gen`

## Configuración de el reloj de hardware

Cuando GNU/Linux arranca, el sistema está configurado para leer el reloj interno del equipo, después el reloj del sistema, que es independiente. Usaremos el comando hwclock -w para ajustar el reloj interno.

`$ hwclock -w`
## Configurar distribución de teclado

Ahora, para configurar la distribución de nuestro teclado y dejarlo con el idioma que escogimos al principio de toda la instalación, cuando usamos el comando loadkeys (pero siempre tendremos que escoger nuestra distribución de teclado en las configuraciones de Teclado del entorno gráfico que escojas):

`$ echo KEYMAP=es > /etc/vconsole.conf`

## Instalar grub
Ahora procedamos a instalar el grub y usar el comando correcto, dependiendo si usas UEFI o No.

Sin UEFI
```
$ grub-install /dev/sda
$ grub-mkconfig -o /boot/grub/grub.cfg

```
## Verificar sistemas operativos instalados

Si estás haciendo un dualboot con windows y cuando estabas configurando el grub, no te apareción windows u otro sistema operativo en la lista, usa el comando `os-prober`

## Establecer contraseña del Administrador (root)

Establecemos una contraseña para root:

`$ passwd`

Escribes la contraseña que desees. No te mostrará nada al escribir, así que fíjate muy bien cuál pondrás de root. Te pedirá nuevamente que confirme la contraseña que acabas de ingresar y una vez confirma, pasemos a lo siguiente.

## Crear usuario

Ahora creamos un usuario con los permisos correspondientes:

``` 
$ useradd -m -g users -G audio,lp,optical,storage,video,wheel,games,power,scanner -s /bin/bash tu_usuario
# Le cambiamos la contraseña
$ passwd tu_usuario
```
## Saliendo de chroot

Ya terminado esto, salimos de chroot
`$ exit`

## Dosmontar particiones y reinicio de sistema

Es importante desmontar las particiones en el siguiente orden:

    > /boot o /boot/efi
    > /home
    > /

O todo junto con:

`$ umount -R /mnt`


# Configuracion post instalacion
## Configuracion de la red
```
$ ip link
```
> 2: enp0s25: <BROADCAST, MU......
Habilitamos el cliente dhcp para la interfaz..
``` 
$ sudo systemctl enable dhcpcd@enp0s25.service
$ sudo systemctl start dhcpcd@enp0s25.service
$ ip addr show
```
Tambien es importante establecer los DNS, últimamente pacman y yay para algunos paquetes exisgen que /etc/resolv.conf sea explicitamente creado:
``` 
~]$ cat << EOF | sudo tee /etc/resolv.conf  
# Generated by dhcpcd
# /etc/resolv.conf.head can replace this line
# /etc/resolv.conf.tail can replace this line

# Google DNS
nameserver 8.8.8.8 
nameserver 8.8.4.4
``` 
Actualizamos el sistema
`$ pacman -Syyu`

## Repositorios AUR y el gestor de paquetes yay.
Una vez hecho, pasaremos a algo importante y es agregar el repositorio AUR,(Arch Users Repository) que es donde se alberga una gran cantidad de paquetería a parte de las que hay en los repositorios oficiales de Arch Linux, y es mantenida por la comunidad de usuarios de dicha distribución. Si no encuentras algo en los oficiales, seguramente estará en AUR y eso es una de las grandes ventajas de Arch Linux. Ya no necesitarás buscar más repositorios como en Debian, Ubuntu y derivados, en AUR está casi todo.

Abriremos un terminal y escribimos:

`sudo nano /etc/pacman.conf`

Donde nano es un editor de texto por consola y lo utilizaremos para editar el archivo de configuracion de pacman. Pegamos el repositorio al final de community

> [archlinuxfr]
> SigLevel = Optional TrustAll
> Server = http://repo.archlinux.fr/$arch

`$ pacman  -Sy`

Ahora procedamos instalar un AURHelper, porque pacman, el gestor de paquetes, no nos permite utilizarlo para instalar paquetería de AUR. No recomiendo yaourt, que era uno de los más populares, ya que el proyecto fue descontinuado. Tampoco trizen y aurman. Usaremos yay y para instarlo haremos lo siguiente en un terminal:
```shell
$ pacman -S git
$ git clone https://aur.archlinux.org/yay.git
cd yay
makepkg -si
```
Yay usa la misma estructura que pacman, y anteriormente ya puse los comandos básicos para pacman, solo reemplaza pacman por yay. Como ejemplo:

En vez de: sudo pacman -S "paquete" para instalar un paquete, reemplaza pacman por yay, yay -S "paquete".

y así sucesivamente…

### Servidor sshd

```shell 
$ pacman -S openssh 
$ systemctl enable sshd
$ systemctl start sshd
$ systemctl status sshd
```
Para editar la configuracion:
`$ sudo nano /etc/ssh/sshd_config`
y despues reiniciamos el servicio:
`$ sudo systemctl restart sshd`

Finalmente copiamos nuestra ID RSA a la nueva maquina

The ssh-copy-id command (in the openssh-client package and installed by default) does exactly this:
`$ ssh-copy-id user@hostname.example.com`
copies the public key of your default identity (use -i identity_file for other identities) to the remote hos
